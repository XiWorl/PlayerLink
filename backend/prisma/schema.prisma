generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AccountType {
  player
  team
}

enum ApplicationStatus {
  pending
  accepted
  rejected
}

model Account {
  id Int @id @default(autoincrement())
  createdAt  DateTime @default(now())
  accountType AccountType
  email String @unique
  player Player?
  team  Team?
  playerApplications Application[] @relation("PlayerApplications")
  teamApplications Application[] @relation("TeamApplications")
  sentMessages Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
}

model Player {
  playerId  Int @id @default(autoincrement())
  firstName String
  lastName  String?
  yearsOfExperience String
  location    String
  willingToRelocate Boolean
  playstyle String
  gamingExperience String[]
  games Json
  gameUsernames Json
  bio         String?
  about      String?
  accountId  Int @unique
  rosterAccountIds Int[]
  recommendationStatistics Json
  account     Account @relation(fields: [accountId], references: [id])
}

model Team {
  teamId     Int @id @default(autoincrement())
  name       String
  location   String
  rosterAccountIds Int[]
  currentlyHiring Boolean
  desiredPlaystyle String[]
  supportedGames String[]
  desiredSkillLevel String
  description String?
  overview   String?
  recommendationHistory Json
  accountId  Int @unique
  account     Account @relation(fields: [accountId], references: [id])
}

model Application {
  applicationId Int @id @default(autoincrement())
  createdAt  DateTime @default(now())
  playerAccountId  Int
  teamAccountId     Int
  status     ApplicationStatus @default(pending)
  playerAccount     Account @relation(fields: [playerAccountId], references: [id], name: "PlayerApplications")
  teamAccount      Account @relation(fields: [teamAccountId], references: [id], name: "TeamApplications")

  @@unique([playerAccountId, teamAccountId])
}

model Tournaments {
  id Int @id @default(autoincrement())
  tournamentIds Int[]
  tournaments Tournament[] @relation("TournamentsList")
}

model Tournament {
  tournamentId Int @id @default(autoincrement())
  name String
  rounds Json
  minimumParticipants Int
  currentRound Int @default(1)
  createdAt DateTime @default(now())
  creatorAccountId Int
  allTournamentsId Int
  isActive Boolean
  allParticipants Json
  participantsAdvancedToNextRound Json
  allTournaments Tournaments @relation("TournamentsList", fields: [allTournamentsId], references: [id])
}

model Message {
  id Int @id @default(autoincrement())
  content String
  createdAt DateTime @default(now())
  isRead Boolean @default(false)

  senderId Int
  sender Account @relation("SentMessages", fields: [senderId], references: [id])

  receiverId Int
  receiver Account @relation("ReceivedMessages", fields: [receiverId], references: [id])

  @@index([senderId])
  @@index([receiverId])
}
